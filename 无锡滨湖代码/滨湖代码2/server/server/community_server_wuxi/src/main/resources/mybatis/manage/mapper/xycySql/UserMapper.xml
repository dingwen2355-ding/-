<?xml version="1.0" encoding="UTF-8"?>
<!DOCTYPE mapper PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN" "http://mybatis.org/dtd/mybatis-3-mapper.dtd">
<mapper namespace="com.znv.manage.xycy.dao.UserDao">

    <select id="queryUserGpsList" resultType="map">
        SELECT
            t.user_id userId,
            t.clock_lng gpsx,
            t.clock_lat gpsy
        FROM
            (
                SELECT
                    max(clock_time) AS clock_time,
                    user_id

                FROM
                    tbl_clock_details
                where 1=1
                    <if test="userId != null and userId != ''">and user_id = #{userId}</if>
                GROUP BY
                    user_id
            ) a
                LEFT JOIN tbl_clock_details t ON t.user_id = a.user_id
                AND t.clock_time = a.clock_time
                inner join tbl_users b on a.user_id = b.user_id
                <if test="names != null">and find_in_set(b.name,#{names})</if>
    </select>

    <select id="queryUserGpsListByUserId" resultType="map">
        SELECT
            user_id userId,
            clock_lng gpsx,
            clock_lat gpsy,
            date_format(clock_time,'%Y-%m-%d %H:%i:%s') clockTime
        FROM
            tbl_clock_details
        where user_id = #{userId}
        ORDER BY clock_time
    </select>

    <select id="queryUserInfo" resultType="map">
        SELECT
        user_id userId,
        name,
        mobile,
        positions
        FROM
        tbl_users
        where 1=1
        <if test="userId != null and userId != ''">and user_id = #{userId}</if>

    </select>
</mapper>